<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Doubling Data for Performance Testing | Jesse Builds Software</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-17968343-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Doubling Data for Performance Testing</h1><a id="logo" href="/.">Jesse Builds Software</a><p class="description">Jesse's thoughts on building quality software.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Doubling Data for Performance Testing</h1><div class="post-meta">2011-08-11<span> | </span><span class="category"><a href="/categories/uncategorized/">uncategorized</a></span></div><div class="post-content"><p><strong>Or: The Most Impressive T-SQL Script I’ve Ever Written</strong></p>
<p>I was recently working on a new application. After three months in the field, users were starting to complain about performance issues. We had done some limited performance tuning for the first release, and more as part of the second release, but new issues were popping up as more data got entered into the system. We could have continued fixing issues as they came up, one release at a time, but we wanted to get ahead of the problem, and the client wanted to know that the system would remain usable without developer intervention for a few years at least.</p>
<p>The nature of the business was such that the rate of data entry and number of concurrent users shouldn’t change much over time. This meant that increasing the amount of data would be a good approximation of how the system would look in the future. How do you increase the amount of data in a normalized relational database? It would be difficult to enter realistic test data manually, and unrealistic test data can cause unrealistic test results. Bad results means we waste time fixing issues that wouldn’t appear, and never get a chance to detect issues that will.</p>
<p>I proposed creating a T-SQL script that would double all the existing data. Running it once would simulate six months of usage, running it again simulates a year, twice more and we’re simulating four years of usage. Once it was approved, it took me a couple days to finish, about half of that going to testing and debugging. The result is the most impressive T-SQL script I’ve ever written.</p>
<p>The script I wrote didn’t do the actual duplication, it combined hand-entered metadata with data from sys.tables and sys.columns to generate a much bigger script. Not only was it faster to write this way, but it made it easier to fix issues, and it allowed the script to be reused after columns were added to the database.</p>
<p>I had one table variable with a list of tables to copy, and another defining the relationships between foreign keys and their source tables. Most foreign keys were named the same in all tables that they appeared in, so a single mapping was often enough for all of them. Most of the mappings could be determined from the list of tables itself, so I only had a few other relationships and special column rules that had to be entered manually.</p>
<p>Another factor that helped was our use of guids for all primary keys. Because the can be determined before inserting a row, it was possible to generate the mapping from old to new key at the start of the script. I could also use a single insert statement for each table, and the order of execution only mattered where foreign key constraints existed.</p>
<p>The results were tremendous. We found a bunch of issues we wouldn’t have found otherwise, and had a fairly solid indication of how the application would behave years in the future.</p>
</div><div class="tags"><a href="/tags/database/"><i class="fa fa-tag"></i>database</a><a href="/tags/performance/"><i class="fa fa-tag"></i>performance</a><a href="/tags/debugging/"><i class="fa fa-tag"></i>debugging</a></div><div class="post-nav"><a class="pre" href="/2011/10/managing-priorities-outside-of-work/">Managing Priorities Outside of Work</a><a class="next" href="/2011/06/the-critical-path/">The Critical Path</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://www.jessemcdowell.ca"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="/mysterysolver/" title="Mystery Solver" target="_blank">Mystery Solver</a><ul></ul><a href="/license/" title="License" target="_blank">License</a></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/blogging/" style="font-size: 15px;">blogging</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a> <a href="/tags/open-source/" style="font-size: 15px;">open source</a> <a href="/tags/design/" style="font-size: 15px;">design</a> <a href="/tags/ioc/" style="font-size: 15px;">ioc</a> <a href="/tags/unit-testing/" style="font-size: 15px;">unit testing</a> <a href="/tags/database/" style="font-size: 15px;">database</a> <a href="/tags/entity-framework/" style="font-size: 15px;">entity framework</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/c/" style="font-size: 15px;">c#</a> <a href="/tags/leadership/" style="font-size: 15px;">leadership</a> <a href="/tags/career/" style="font-size: 15px;">career</a> <a href="/tags/consulting/" style="font-size: 15px;">consulting</a> <a href="/tags/performance/" style="font-size: 15px;">performance</a> <a href="/tags/learning/" style="font-size: 15px;">learning</a> <a href="/tags/angular/" style="font-size: 15px;">angular</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/food/" style="font-size: 15px;">food</a> <a href="/tags/tea/" style="font-size: 15px;">tea</a> <a href="/tags/server-graphs/" style="font-size: 15px;">server graphs</a> <a href="/tags/recipes/" style="font-size: 15px;">recipes</a> <a href="/tags/bugs/" style="font-size: 15px;">bugs</a> <a href="/tags/debugging/" style="font-size: 15px;">debugging</a> <a href="/tags/war-stories/" style="font-size: 15px;">war stories</a> <a href="/tags/devops/" style="font-size: 15px;">devops</a> <a href="/tags/Net/" style="font-size: 15px;">.Net</a> <a href="/tags/gadgets/" style="font-size: 15px;">gadgets</a> <a href="/tags/project-management/" style="font-size: 15px;">project management</a> <a href="/tags/people-management/" style="font-size: 15px;">people management</a> <a href="/tags/management/" style="font-size: 15px;">management</a> <a href="/tags/interviewing/" style="font-size: 15px;">interviewing</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">Jesse Builds Software.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>