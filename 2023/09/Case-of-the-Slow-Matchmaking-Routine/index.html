<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Case of the Slow Matchmaking Routine | Jesse Builds Software</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script src="https://www.googletagmanager.com/gtag/js?id=UA-17968343-1" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-17968343-1');
</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "19dbe594294e444cab1e984fe13d4e7a"}'></script><meta name="generator" content="Hexo 7.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Case of the Slow Matchmaking Routine</h1><a id="logo" href="/.">Jesse Builds Software</a><p class="description">Jesse's thoughts on building quality software.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Case of the Slow Matchmaking Routine</h1><div class="post-meta">2023-09-05</div><div class="post-content"><p>The most challenging bug I’ve ever fixed was a performance issue in a matchmaking routine. Matchmaking is the process of finding players to compete against each other in a video game. An excellent matchmaking algorithm doesn’t just stick players together randomly; it tries to make the game more fun by balancing power levels and preventing anyone from waiting too long for a match.</p>
<p>About six weeks before a game I was working on was scheduled to be feature complete, we discovered our routine couldn’t handle our load targets. The rate at which players were being removed from the matchmaking queue started dropping during load tests. Things got bad quickly once it fell below the rate at which we inserted them. Not only would this cause a bad user experience if we didn’t fix it, but it made it impossible for us to drive enough traffic to our game servers to test that they could handle the projected load. The company wasn’t going to release a game that could crash if it was successful, so we had to fix this issue, and we had to fix it quickly.</p>
<p>To make matters worse, we could only reproduce the bug in our production system. We had to simulate hundreds of thousands of users to hit it, which just wasn’t possible on a developer machine. Fortunately, our production system was available for testing. Unfortunately, a team on another continent was running the load tests. It took us a day to deploy a new version and a couple of days for them to run the test. With time zone differences expanding the handoffs, the fastest we could iterate was about once a week.</p>
<p><a href="/2023/04/How-to-Fix-a-Bug/">As I’ve described before</a>, I like to find a bug, understand it, and then fix it. In this case we couldn’t figure it out by looking at the code, even with many smart people trying. This is one of those rare cases where I had to try fixing a bug before understanding it.</p>
<p>The week of iteration time also meant I had about a week to review the results, consider multiple possibilities, and sprinkle logging and profiling code all over the place, so I did that, too.</p>
<p> I plugged away at it week after week, but the problem was stubbornly difficult to find. The failing load tests were visible to our management chain, so I also had a fair number of questions about when it would be fixed (which I couldn’t estimate), how we were fixing it, and what we would do if we couldn’t fix it. I was also helping the rest of the team with their deliverables, which had the same deadline, so it was stressful for everyone. Nevertheless, I stuck to my process, narrowed down the location of the problem, and tested my fixes as best as possible in my development environment. Eventually, I figured it out.</p>
<p>The problem originated in a database query we used to find matches. It used a cartesian join, which takes exponentially longer to complete as more rows are added (<code>O(n²)</code> complexity). At some queue length, the processing time increases from milliseconds to seconds, and then it quickly increases from seconds to minutes. It also didn’t help that our contrived load test meant thousands of users were all attempting to make matches with the same power rating, thus making it harder to distinguish suitable matches.</p>
<p>After all the time it took to find the problem, it only took a day to fix it. I replaced the algorithm with one that processed matches linearly, giving it <code>O(n)</code> complexity.</p>
<p>About a week later, I got an email confirming that the issue was fixed. Since the report came in overnight, it was the first thing I read in the morning. It was exhilarating, but the day is still bittersweet in my memory. About an hour later, I attended a last-minute team-wide meeting where we were all let go. The game was never released.</p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/debugging/" rel="tag">debugging</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/video-games/" rel="tag">video games</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/war-stories/" rel="tag">war stories</a></li></ul></div><div class="post-nav"><a class="pre" href="/2023/09/Choosing-Powerful-Names/">Choosing Powerful Names</a><a class="next" href="/2023/08/Regarding-Test-Coverage-Targets/">Regarding Test Coverage Targets</a></div><script src="https://utteranc.es/client.js" repo="jessemcdowell/jessemcdowell-blog-comments" issue-term="title" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://jessemcdowell.ca"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://pragmaticpotato.com/" title="Pragmatic Potato Software" target="_blank">Pragmatic Potato Software</a><ul></ul><a href="/resources/" title="Resources" target="_blank">Resources</a><ul></ul><a href="/mysterysolver/" title="Mystery Solver" target="_blank">Mystery Solver</a><ul></ul><a href="/licence/" title="Licence" target="_blank">Licence</a></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/blogging/" style="font-size: 15px;">blogging</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a> <a href="/tags/devops/" style="font-size: 15px;">devops</a> <a href="/tags/design/" style="font-size: 15px;">design</a> <a href="/tags/gadgets/" style="font-size: 15px;">gadgets</a> <a href="/tags/ioc/" style="font-size: 15px;">ioc</a> <a href="/tags/unit-testing/" style="font-size: 15px;">unit testing</a> <a href="/tags/open-source/" style="font-size: 15px;">open source</a> <a href="/tags/net/" style="font-size: 15px;">.net</a> <a href="/tags/debugging/" style="font-size: 15px;">debugging</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/database/" style="font-size: 15px;">database</a> <a href="/tags/entity-framework/" style="font-size: 15px;">entity framework</a> <a href="/tags/people-management/" style="font-size: 15px;">people management</a> <a href="/tags/c/" style="font-size: 15px;">c#</a> <a href="/tags/interviewing/" style="font-size: 15px;">interviewing</a> <a href="/tags/food/" style="font-size: 15px;">food</a> <a href="/tags/leadership/" style="font-size: 15px;">leadership</a> <a href="/tags/career/" style="font-size: 15px;">career</a> <a href="/tags/consulting/" style="font-size: 15px;">consulting</a> <a href="/tags/project-management/" style="font-size: 15px;">project management</a> <a href="/tags/performance/" style="font-size: 15px;">performance</a> <a href="/tags/learning/" style="font-size: 15px;">learning</a> <a href="/tags/practices/" style="font-size: 15px;">practices</a> <a href="/tags/quality/" style="font-size: 15px;">quality</a> <a href="/tags/tea/" style="font-size: 15px;">tea</a> <a href="/tags/angular/" style="font-size: 15px;">angular</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/recipes/" style="font-size: 15px;">recipes</a> <a href="/tags/bugs/" style="font-size: 15px;">bugs</a> <a href="/tags/video-games/" style="font-size: 15px;">video games</a> <a href="/tags/war-stories/" style="font-size: 15px;">war stories</a> <a href="/tags/community/" style="font-size: 15px;">community</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/argocd/" style="font-size: 15px;">argocd</a> <a href="/tags/architecture/" style="font-size: 15px;">architecture</a> <a href="/tags/resources/" style="font-size: 15px;">resources</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/reviews/" style="font-size: 15px;">reviews</a> <a href="/tags/pragmatic-potato/" style="font-size: 15px;">pragmatic potato</a> <a href="/tags/howto/" style="font-size: 15px;">howto</a> <a href="/tags/code-reviews/" style="font-size: 15px;">code reviews</a> <a href="/tags/household-organization/" style="font-size: 15px;">household organization</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/typescript/" style="font-size: 15px;">typescript</a> <a href="/tags/home-assistant/" style="font-size: 15px;">home assistant</a> <a href="/tags/home-automation/" style="font-size: 15px;">home automation</a> <a href="/tags/japanese/" style="font-size: 15px;">japanese</a> <a href="/tags/coffee/" style="font-size: 15px;">coffee</a> <a href="/tags/powershell/" style="font-size: 15px;">powershell</a> <a href="/tags/parenting/" style="font-size: 15px;">parenting</a> <a href="/tags/architectural-decision/" style="font-size: 15px;">architectural decision</a></div></div><div class="widget"><div class="widget-title">Subscribe</div><ul></ul><i class="fa fa-rss"></i><a href="/atom.xml" title="Atom" target="_blank"> Atom</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">Jesse Builds Software.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>