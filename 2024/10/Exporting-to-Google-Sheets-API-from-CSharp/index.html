<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Exporting to Google Sheets API from C# | Jesse Builds Software</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script src="https://www.googletagmanager.com/gtag/js?id=UA-17968343-1" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-17968343-1');
</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "19dbe594294e444cab1e984fe13d4e7a"}'></script><meta name="generator" content="Hexo 7.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Exporting to Google Sheets API from C#</h1><a id="logo" href="/.">Jesse Builds Software</a><p class="description">Jesse's thoughts on building quality software.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Exporting to Google Sheets API from C#</h1><div class="post-meta">2024-10-06</div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Google-Apis-Sheets-v4-Package"><span class="toc-number">1.</span> <span class="toc-text">Google.Apis.Sheets.v4 Package</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Authentication"><span class="toc-number">2.</span> <span class="toc-text">Authentication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spreadsheet-Sheet-and-Range-Identifiers"><span class="toc-number">3.</span> <span class="toc-text">Spreadsheet, Sheet, and Range Identifiers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update-Types"><span class="toc-number">4.</span> <span class="toc-text">Update Types</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ETags"><span class="toc-number">5.</span> <span class="toc-text">ETags</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Performance-Update-Size"><span class="toc-number">6.</span> <span class="toc-text">Performance &#x2F; Update Size</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-number">7.</span> <span class="toc-text">Conclusion</span></a></li></ol></div></div><div class="post-content"><p>I recently did a project for a client that needed a way to share a bit of live data with an external organization. He originally asked for a simple website with authentication and an API. I could have built this, but for the frequency and volumes of data they were using, I suggested a simpler approach: a Google Sheet and a recurring job that updates it.</p>
<p>Any online spreadsheet is a great way to share a small amount of data. Users can filter, sort, make formulas, export the data, or even write their own integrations. It’s also possible (depending on how changes are handled) to manually annotate or override data that’s been exported. Implementing all of this in a custom web page is possible, but some of it is pretty tricky.</p>
<p>The project was a success, and I’m happy with the results. Working with the Google Sheets API was not as straightforward as I had expected though. It was hard to find documentation, or even many examples showing how to use it. I’m not sure why this is. In this post I’ll share some of the things I learned.</p>
<h2 id="Google-Apis-Sheets-v4-Package"><a href="#Google-Apis-Sheets-v4-Package" class="headerlink" title="Google.Apis.Sheets.v4 Package"></a>Google.Apis.Sheets.v4 Package</h2><p>The <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Google.Apis.Sheets.v4/">Google.Apis.Sheets.v4 package</a> is the official .NET client library for the Google Sheets API. You can install it with NuGet.</p>
<p>It has <a target="_blank" rel="noopener" href="https://googleapis.dev/dotnet/Google.Apis.Sheets.v4/latest/api/Google.Apis.Sheets.v4.html">official documentation</a>, but I found it to be almost useless. I recommend the <a target="_blank" rel="noopener" href="https://developers.google.com/sheets/api/reference/rest">Google Sheets API documentation</a> instead. It has much more information about how the API works and what the arguments mean. Methods and properties in .NET client library match the Rest API documentation exactly, I assume this is a result of the client library being auto-generated.</p>
<p>My first tip is to make sure you’re using the exact name for an API endpoint. For example, these two APIs, although seemingly similar, take different arguments, and behave totally differently:</p>
<ul>
<li><code>service.Spreadsheets.BatchUpdate()</code></li>
<li><code>service.Spreadsheets.Values.BatchUpdate()</code></li>
</ul>
<p>Another thing to be aware of is that the methods above don’t actually call the service, they create a request object. They almost look like they can be used in a fluent style, but this is only possible for the simplest get calls. I found it much easier to assign the request object into a variable so that I could set its properties directly. For example:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> range = <span class="string">&quot;!A1:A3&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> change = <span class="keyword">new</span> ValueRange</span><br><span class="line">&#123;</span><br><span class="line">    Range = range,</span><br><span class="line">    MajorDimension = <span class="string">&quot;ROWS&quot;</span>,</span><br><span class="line">    Values = [[<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> request = service.Spreadsheets.Values.Update(change, <span class="string">&quot;SHEET_ID&quot;</span>, range);</span><br><span class="line">request.ValueInputOption = SpreadsheetsResource.ValuesResource.UpdateRequest.ValueInputOptionEnum.RAW;</span><br><span class="line"><span class="keyword">var</span> result = <span class="keyword">await</span> request.ExecuteAsync();</span><br></pre></td></tr></table></figure>

<p>Notice how I passed an array of arrays to the <code>Values</code> property? The API uses lists of lists for most values. This is necessary when the data includes multiple rows, but a bit annoying when updating single rows or cells. Fortunately it’s pretty easy to make an inline Array in modern C#, and an Array implements <code>IList</code>.</p>
<p>Each request object does have a <code>Configure()</code> method that allows you to set properties inline, but I found it even more verbose than working with the request object directly.</p>
<h2 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h2><p>There are <a target="_blank" rel="noopener" href="https://developers.google.com/workspace/guides/create-credentials">a bunch of ways to authenticate to the Google APIs</a>, but I found the choices overwhelming. For my purposes (a background service that needs to authenticate as a single user without a human present) a <a target="_blank" rel="noopener" href="https://cloud.google.com/iam/docs/service-account-overview">service account</a> seemed like the best choice.</p>
<p>You can generate a service account in <a target="_blank" rel="noopener" href="https://console.cloud.google.com/">the Google Cloud Console</a>. You’ll need a project. Also make sure to enable the Google Sheets API for your project. The UI in the console changes all the time, so you’ll be better off looking up instructions in the official documentation.</p>
<p>Once the account is created, you can download the JSON key file, and use this in your client code like this:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> credential = GoogleCredential</span><br><span class="line">    .FromJson(<span class="string">&quot;&lt;your JSON here&gt;&quot;</span>) <span class="comment">// or use .FromFile() and pass the path</span></span><br><span class="line">    .CreateScoped(SheetsService.ScopeConstants.Spreadsheets);</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> service = <span class="keyword">new</span> SheetsService(<span class="keyword">new</span> BaseClientService.Initializer</span><br><span class="line">    &#123;</span><br><span class="line">        HttpClientInitializer = credential</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>When retrieving this file, also take note of the service account email address (the property <code>client_email</code> in the JSON key file). You will need to share any google documents with this email address for the account to have access to them.</p>
<h2 id="Spreadsheet-Sheet-and-Range-Identifiers"><a href="#Spreadsheet-Sheet-and-Range-Identifiers" class="headerlink" title="Spreadsheet, Sheet, and Range Identifiers"></a>Spreadsheet, Sheet, and Range Identifiers</h2><p>There are three kinds of identifiers you need to be aware of (<a target="_blank" rel="noopener" href="https://developers.google.com/sheets/api/guides/concepts">documentation here</a>):</p>
<ul>
<li><strong>Spreadsheet</strong> - This is the top-level document identifier. You’ll find it in the URL for the Google Sheets Spreadsheet.</li>
<li><strong>Sheet</strong> - This is the tab within the Spreadsheet, also identified by the gid in the URL. It’s usually passed as the first part of the range (before the <code>!</code>). I’ve found that an empty string refers to the first (auto-generated) sheet in the document (gid 0), or you can use the name of the sheet. I haven’t had success passing the gid (instead of the name) even though the documentation says it’s supported.</li>
<li><strong>Range</strong> - Most of the API calls require a range. This refers to a rectangular group of Cells, and there are two ways to specify them:<ul>
<li><strong>A1 notation</strong> is the most familiar and most supported. For example <code>Sheet1!A1:D1</code> will refer to the first four Cells in the first Row of the Sheet named “Sheet1”.</li>
<li><strong>R1C1 notation</strong> is another syntax that can be used with some api methods. The above example would look like <code>Sheet1!R1C1:R1C4</code> in R1C1 notation. It can be pretty handy when doing computed updates because you don’t have to convert the column index to a letter&#x2F;letters. Unfortunately, it doesn’t seem to be supported by all the API methods.</li>
</ul>
</li>
</ul>
<p>If you need to compute the column letter(s) for a given index, you can use this code:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetColumnNameFromIndex</span>(<span class="params"><span class="built_in">int</span> columnIndex</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">int</span> numberOfLetters = <span class="number">26</span>;</span><br><span class="line">    <span class="keyword">if</span> (columnIndex &gt;= numberOfLetters)</span><br><span class="line">        <span class="keyword">return</span> GetColumnNameFromIndex(columnIndex / numberOfLetters - <span class="number">1</span>) +</span><br><span class="line">               GetColumnNameFromIndex(columnIndex % numberOfLetters);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">char</span> firstColumnLetter = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> ((<span class="built_in">char</span>)(firstColumnLetter + columnIndex)).ToString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Update-Types"><a href="#Update-Types" class="headerlink" title="Update Types"></a>Update Types</h2><p>There are three kinds of changes you can make to a sheet:</p>
<ul>
<li><strong>Update</strong> - this is the simplest, allowing you to update a single range of cells. Use these sparingly. Batch updates will be much more efficient where they’re possible.</li>
<li><strong>Batch Update</strong> - this method takes an array of range update blocks and processes them all together.</li>
<li><strong>Append</strong> - This method allows you to stick rows on the end of the document. It requires a range, but it’s okay to use row 1. It will automatically stick the new values at the end of the sheet for you.</li>
</ul>
<h2 id="ETags"><a href="#ETags" class="headerlink" title="ETags"></a>ETags</h2><p>All change requests and get responses include an ETag property. In an ideal world, you would include the ETag from your get request when you send an update so that any changes that have occurred since are taken into account. Unfortunately, this property never seems to be set during get requests, and I couldn’t figure out how to make it work.</p>
<p>In all of my testing, the APIs were responding quickly enough that it likely wouldn’t matter. If you have a much longer process between gets and updates, you may need to figure this out. Please comment below if you do!</p>
<h2 id="Performance-Update-Size"><a href="#Performance-Update-Size" class="headerlink" title="Performance &#x2F; Update Size"></a>Performance &#x2F; Update Size</h2><p>I couldn’t find any documentation on the limits of the API, so I did some rough testing instead. I found that a batch update with 10,000 cell updates in it (each as a separate change in the request) took only 1.9 seconds. This goes way beyond what my client could ever need.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Google sheets are a great way to share data from an automated process. Although it took a little while to figure out how to read and write data at all, once I had it working, the Google Sheets API worked great. Even better, my client was thrilled with the results.</p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/net/" rel="tag">.net</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/" rel="tag">c#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/consulting/" rel="tag">consulting</a></li></ul></div><div class="post-nav"><a class="pre" href="/2024/11/Abandoning-Household-Organization/">Abandoning Household Organization</a><a class="next" href="/2024/09/Using-WeeChat-on-Windows-11/">Using WeeChat and weechat-android on Windows 11</a></div><script src="https://utteranc.es/client.js" repo="jessemcdowell/jessemcdowell-blog-comments" issue-term="title" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://jessemcdowell.ca"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://pragmaticpotato.com/" title="Pragmatic Potato Software" target="_blank">Pragmatic Potato Software</a><ul></ul><a href="/resources/" title="Resources" target="_blank">Resources</a><ul></ul><a href="/mysterysolver/" title="Mystery Solver" target="_blank">Mystery Solver</a><ul></ul><a href="/licence/" title="Licence" target="_blank">Licence</a></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/blogging/" style="font-size: 15px;">blogging</a> <a href="/tags/design/" style="font-size: 15px;">design</a> <a href="/tags/open-source/" style="font-size: 15px;">open source</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a> <a href="/tags/devops/" style="font-size: 15px;">devops</a> <a href="/tags/gadgets/" style="font-size: 15px;">gadgets</a> <a href="/tags/ioc/" style="font-size: 15px;">ioc</a> <a href="/tags/unit-testing/" style="font-size: 15px;">unit testing</a> <a href="/tags/net/" style="font-size: 15px;">.net</a> <a href="/tags/debugging/" style="font-size: 15px;">debugging</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/database/" style="font-size: 15px;">database</a> <a href="/tags/entity-framework/" style="font-size: 15px;">entity framework</a> <a href="/tags/people-management/" style="font-size: 15px;">people management</a> <a href="/tags/food/" style="font-size: 15px;">food</a> <a href="/tags/leadership/" style="font-size: 15px;">leadership</a> <a href="/tags/project-management/" style="font-size: 15px;">project management</a> <a href="/tags/career/" style="font-size: 15px;">career</a> <a href="/tags/c/" style="font-size: 15px;">c#</a> <a href="/tags/interviewing/" style="font-size: 15px;">interviewing</a> <a href="/tags/consulting/" style="font-size: 15px;">consulting</a> <a href="/tags/learning/" style="font-size: 15px;">learning</a> <a href="/tags/practices/" style="font-size: 15px;">practices</a> <a href="/tags/performance/" style="font-size: 15px;">performance</a> <a href="/tags/quality/" style="font-size: 15px;">quality</a> <a href="/tags/angular/" style="font-size: 15px;">angular</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/tea/" style="font-size: 15px;">tea</a> <a href="/tags/recipes/" style="font-size: 15px;">recipes</a> <a href="/tags/bugs/" style="font-size: 15px;">bugs</a> <a href="/tags/war-stories/" style="font-size: 15px;">war stories</a> <a href="/tags/video-games/" style="font-size: 15px;">video games</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/argocd/" style="font-size: 15px;">argocd</a> <a href="/tags/community/" style="font-size: 15px;">community</a> <a href="/tags/architecture/" style="font-size: 15px;">architecture</a> <a href="/tags/resources/" style="font-size: 15px;">resources</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/reviews/" style="font-size: 15px;">reviews</a> <a href="/tags/howto/" style="font-size: 15px;">howto</a> <a href="/tags/code-reviews/" style="font-size: 15px;">code reviews</a> <a href="/tags/pragmatic-potato/" style="font-size: 15px;">pragmatic potato</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/typescript/" style="font-size: 15px;">typescript</a> <a href="/tags/household-organization/" style="font-size: 15px;">household organization</a> <a href="/tags/powershell/" style="font-size: 15px;">powershell</a> <a href="/tags/architectural-decision/" style="font-size: 15px;">architectural decision</a> <a href="/tags/japanese/" style="font-size: 15px;">japanese</a> <a href="/tags/parenting/" style="font-size: 15px;">parenting</a> <a href="/tags/home-assistant/" style="font-size: 15px;">home assistant</a> <a href="/tags/home-automation/" style="font-size: 15px;">home automation</a> <a href="/tags/coffee/" style="font-size: 15px;">coffee</a></div></div><div class="widget"><div class="widget-title">Subscribe</div><ul></ul><i class="fa fa-rss"></i><a href="/atom.xml" title="Atom" target="_blank"> Atom</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">Jesse Builds Software.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>